<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GenDiploma Web</title>
  <link rel="stylesheet" href="/static/styles.css?v=2" />
</head>
<body>
  <div class="page">
    <header class="hero">
      <div class="hero-text">
        <h1>××¢×¨×›×ª ×©×œ×™×—×ª ×ª×¢×•×“×•×ª</h1>
        <div class="hero-credit">Â© Rony Gabbai Â· rony.gabbai@gmail.com</div>
      </div>
    </header>

    <main class="grid">
      <section class="panel">
        <h2>Inputs</h2>
        <form id="send-form">
          <section class="form-section section-csv">
            <h3 class="hebrew-header">×”×›× ×¡×ª ×¨×©×™××ª ×¡×˜×•×“× ×˜×™×</h3>
            <label class="field">
              <span>CSV file</span>
              <input type="file" name="csv_file" accept=".csv" />
            </label>

            <div class="csv-actions">
              <button type="button" class="btn" id="preview-csv">Preview CSV</button>
              <button type="button" class="btn" id="select-eligible">Select eligible</button>
              <button type="button" class="btn" id="select-all">Select all</button>
              <button type="button" class="btn" id="clear-selection">Clear selection</button>
              <button type="button" class="btn" id="mark-new">Mark new=1</button>
              <button type="button" class="btn" id="clear-new">Clear new</button>
              <button type="button" class="btn" id="mark-send">Mark send=1</button>
              <button type="button" class="btn" id="clear-send">Clear send</button>
              <button type="button" class="btn" id="download-csv">Download updated CSV</button>
            </div>

            <div class="row">
              <label class="field">
                <span>Save CSV to path (optional)</span>
                <input type="text" id="save-path" placeholder="trauma_1225/list.csv" />
              </label>
              <div class="csv-actions">
                <button type="button" class="btn" id="save-to-output">Save to output folder</button>
                <button type="button" class="btn" id="save-to-path">Save to path</button>
              </div>
            </div>

            <div class="csv-preview">
              <div class="csv-header">
                <h3>Send management</h3>
                <span id="csv-stats">No CSV loaded</span>
              </div>
              <div class="csv-table">
                <table>
                  <thead>
                    <tr>
                      <th>Send</th>
                      <th>Name</th>
                      <th>Email</th>
                      <th>New</th>
                      <th>Send</th>
                    </tr>
                  </thead>
                  <tbody id="csv-rows"></tbody>
                </table>
              </div>
            </div>
          </section>

          <section class="form-section section-pdf">
            <h3 class="hebrew-header">×”×›× ×¡×ª ×ª×¢×•×“×”</h3>
            <label class="field">
              <span>PDF template</span>
              <input type="file" name="pdf_template" accept="application/pdf" required />
            </label>
            <h3 class="hebrew-header">×”×›× ×¡×ª ×œ×•×’×• (××•×¤×¦×™×•× ×œ×™)</h3>
            <label class="field">
              <span>Logo (optional)</span>
              <input type="file" name="logo_file" accept="image/*" />
            </label>
          </section>

          <section class="form-section section-letter">
            <h3 class="hebrew-header">×”×›× ×¡×ª ××›×ª×‘</h3>
            <div class="row">
              <label class="field">
                <span>Letter format</span>
                <div class="choice">
                  <label><input type="radio" name="letter_format" value="html" /> HTML</label>
                  <label><input type="radio" name="letter_format" value="text" checked /> Plain text</label>
                </div>
              </label>
              <label class="field">
                <span>Subject</span>
                <input type="text" name="subject" placeholder="×ª×¢×•×“×ª ×¡×™×•× ×§×•×¨×¡" />
              </label>
            </div>

            <div id="html-panel">
              <label class="field">
                <span>HTML letter</span>
                <textarea name="html_content" id="html-content" rows="10"></textarea>
              </label>

            <div class="emoji-bar" data-target="html-content">
              <span>Emoji</span>
              <button type="button" class="emoji-btn" data-emoji="ğŸ˜Š">ğŸ˜Š</button>
              <button type="button" class="emoji-btn" data-emoji="ğŸ’«">ğŸ’«</button>
              <button type="button" class="emoji-btn" data-emoji="âœ¨">âœ¨</button>
              <button type="button" class="emoji-btn" data-emoji="ğŸ“Œ">ğŸ“Œ</button>
              <button type="button" class="emoji-btn" data-emoji="ğŸ“">ğŸ“</button>
              <button type="button" class="emoji-btn" data-emoji="{% raw %}{{name}}{% endraw %}">add name field</button>
            </div>

              <label class="field">
                <span>Load HTML file</span>
                <input type="file" id="html-file" accept=".html,.htm" />
              </label>
            </div>

            <div id="text-panel" class="hidden">
              <label class="field">
                <span>Plain text letter (Hebrew)</span>
                <textarea name="text_content" id="text-content" rows="10"></textarea>
              </label>

            <div class="emoji-bar" data-target="text-content">
              <span>Emoji</span>
              <button type="button" class="emoji-btn" data-emoji="ğŸ˜Š">ğŸ˜Š</button>
              <button type="button" class="emoji-btn" data-emoji="ğŸ’«">ğŸ’«</button>
              <button type="button" class="emoji-btn" data-emoji="âœ¨">âœ¨</button>
              <button type="button" class="emoji-btn" data-emoji="ğŸ“Œ">ğŸ“Œ</button>
              <button type="button" class="emoji-btn" data-emoji="ğŸ“">ğŸ“</button>
              <button type="button" class="emoji-btn" data-emoji="{% raw %}{{name}}{% endraw %}">add name field</button>
            </div>

              <label class="field">
                <span>Load text file</span>
                <input type="file" id="text-file" accept=".txt" />
              </label>
            </div>
          </section>

          <section class="form-section section-oauth">
            <h3 class="hebrew-header">×—×™×‘×•×¨ ×œ××™×™×œ ×©××× ×• ×”×ª×¢×•×“×•×ª ×™×©×œ×—×•</h3>
            <h3>Gmail OAuth</h3>
            <div class="row oauth-row">
              <div class="field oauth-connect-field">
                <span>Connect</span>
                <div class="actions">
                  <button type="button" class="btn oauth" id="oauth-connect">Connect Google</button>
                  <button type="button" class="btn oauth" id="oauth-logout">Disconnect</button>
                </div>
              </div>
              <label class="field oauth-status-field">
                <span>Status</span>
                <input type="text" id="oauth-status" value="Not connected" readonly />
              </label>
            </div>
            <div class="actions">
              <button type="button" class="btn" id="oauth-check-setup">Check setup</button>
            </div>
            <label class="field">
              <span>From email (auto-filled from Gmail)</span>
              <input type="email" name="from_email" id="from-email" placeholder="from@domain" required />
            </label>
          </section>

          <section class="form-section section-send">
            <h3 class="hebrew-header">×©×œ×™×—×ª ×ª×¢×•×“×•×ª</h3>
            <p class="muted">×©×œ×— ×œ×‘×“×™×§×” ×œ×¤× ×™ ×©×œ×™×—×” ××œ××”</p>
            <div class="row">
              <label class="field">
                <span>Test name</span>
                <input type="text" name="test_name" value="×××™×¨" />
              </label>
              <label class="field">
                <span>Test email</span>
                <input type="email" name="test_email" placeholder="test@domain" />
              </label>
            </div>
            <input type="hidden" name="name_x_offset" id="name-x-offset" value="0" />
            <input type="hidden" name="name_y_offset" id="name-y-offset" value="0" />

            <div class="actions">
              <button type="button" class="btn" data-action="test">Send Test</button>
              <button type="button" class="btn primary" data-action="batch">Send Batch</button>
            </div>
          </section>
        </form>
      </section>

      <section class="panel preview-panel">
        <div class="panel-header">
          <h2>Preview mail content</h2>
          <label class="toggle">
            <input type="checkbox" id="force-rtl" checked />
            <span>Force RTL preview</span>
          </label>
        </div>
        <iframe id="preview" title="HTML Preview"></iframe>
        <h3 class="mt">Preview PDF with student name</h3>
        <div class="pdf-controls">
          <div class="pdf-controls-title">Name position offsets</div>
          <div class="pdf-controls-buttons">
            <button type="button" class="btn" id="pdf-x-minus">X-</button>
            <button type="button" class="btn" id="pdf-x-plus">X+</button>
            <button type="button" class="btn" id="pdf-y-minus">Y-</button>
            <button type="button" class="btn" id="pdf-y-plus">Y+</button>
          </div>
          <div class="pdf-controls-inputs">
            <label class="pdf-controls-field">
              <span>LocationX</span>
              <input type="number" id="pdf-x-input" step="1" value="306" />
            </label>
            <label class="pdf-controls-field">
              <span>LocationY</span>
              <input type="number" id="pdf-y-input" step="1" value="572" />
            </label>
          </div>
          <div class="pdf-controls-status">X: <span id="pdf-x-value">0</span> | Y: <span id="pdf-y-value">0</span></div>
        </div>
        <iframe id="pdf-preview" title="PDF Preview"></iframe>
        <div class="logs-section">
          <h2 class="mt">Logs</h2>
          <pre id="log"></pre>
        </div>
      </section>
    </main>
  </div>

  <script src="/static/app.js"></script>
</body>
</html>
